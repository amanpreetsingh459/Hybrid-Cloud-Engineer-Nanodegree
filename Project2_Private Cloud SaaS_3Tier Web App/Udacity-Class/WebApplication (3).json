{"status":{},"contains_secrets":true,"product_version":"3.0.0.1","spec":{"description":"2-Tier Web Application","resources":{"client_attrs":{"d75c33a3_deployment":{"y":137.5,"x":378}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"95313ecc_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"c19ba9d7_runbook","main_task_local_reference":{"kind":"app_task","name":"95313ecc_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"5fecbe7a_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"fb975c9f_runbook","main_task_local_reference":{"kind":"app_task","name":"5fecbe7a_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Restart"}],"name":"b1dcbad9_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Restart","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"c7ab128f_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"55f5daee_runbook","main_task_local_reference":{"kind":"app_task","name":"b1dcbad9_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"WebServer_Stop"}],"name":"d7c94892_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"WebServer_Stop","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo systemctl stop httpd\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"513e1ace_runbook","main_task_local_reference":{"kind":"app_task","name":"d7c94892_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"WebServer_Restart"}],"name":"fbe5a185_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"WebServer_Restart","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo systemctl restart httpd\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"c7ab128f_runbook","main_task_local_reference":{"kind":"app_task","name":"fbe5a185_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"WebServer","port_list":[],"tier":"","variable_list":[],"description":""}],"substrate_definition_list":[{"description":"","action_list":[],"type":"AHV_VM","name":"WebServerAHV","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"editables":{"readiness_probe":{"connection_type":true,"delay_secs":true,"connection_port":true,"timeout_secs":null},"create_spec":{"name":true,"resources":{"nic_list":{"0":{"subnet_reference":true}},"serial_port_list":{},"num_vcpus_per_socket":true,"num_sockets":true,"memory_size_mib":true,"boot_config":true,"disk_list":{"0":{"data_source_reference":true,"device_properties":{"disk_address":{"adapter_type":true},"device_type":true}}}}}},"os_type":"Linux","create_spec":{"name":"WebServer-@@{calm_time}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"ce0faed5-3310-493a-92a0-e9c09b52382b"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":1,"gpu_list":[],"memory_size_mib":2048,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: @@{superuser.username}@@\n    ssh-authorized-keys:\n      - @@{superuser.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"78f97d28-07c4-4818-ba06-5ce33faa35b6","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CentOS_8_Cloud","uuid":"250b41ee-07d3-30b7-d0ff-62ab6fef09f4"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]}],"credential_definition_list":[{"username":"centos","description":"","type":"KEY","secret":{"attrs":{"is_secret_modified":true,"secret_reference":{}},"value":"OJzWLGC7m+Vs\/hVLUODyFyTIx8KqJRoFXYrUhiO96OhfcFvpBjR4V2nuCZmGvZpMyhm2SCfVIpwfvDDSW6aZhmZszJkIAE7DBtoX1vXu2I0eGMIqEjWX3\/mpao0vHZjHiTSoDpGckg3tyx9yYVdMBT0j24z0nravgnRn\/ZDqtFG9IcRFMYCGqiLRDC+gXrz2sQR33F3DBrh75+JlToS6pRfLZnL32Z6jX6\/adWoELAh9b+\/+\/\/6yviG27A0HCMCRQkmuf+oo+B6RsgeqUYg8gx2pOlYTrv7Ic5dUjlGW0MVrrdNC0q6k+lYg7wgUSW2Q3Tet2H+r7eeaznqZnbjKC1jynes4h5nR6wXAWes7ySkLpwPtXcLasozOwDgDILBKOyk9893z02qSg231f+vlR1oe0OrisPgPXA1\/CJOB6KXqtAgZduIH3IMdaLDxCZKLjU4SHWUJJQK\/dVBHonR+hCvp2123HbzCgwTLA7i7GQ+TgGij4jvqTekOSGEvQUs0YyqHdcJLO8spuruR5t3W6J4iQ+OlujTDXywXvRNNYQyZeWRiz3DUIaASlycLmDso1Ga0cuf07fpbBh1d3PgZ7jftvwVVQ1wQyEnG9mZTJ9tbnJLzo2R5y\/3QjamBCCUWzequGIEr4PWSWWKbOJMZ5IZnuZ1rDd4Op2KZ4gdIU5QBHBksYpnfNn0JD6HSvm9Gsb2lYTXLM07uSeIWsNXNOnYhpo8JfHF7HyEi7oDioo7INJJ1mf2v\/3qcgB3+a2VM3KQiSme1iVhb6rdOtmfw0oW8dJSHxfhGaM8IGfj6jcDfkJgVjh+2ckqQvTO4yk9gupXiPSH3sHE1PUDULLcCbtYB1p7A8oSE5rpRYEuOnJRs92BpBstp7YCxmxInztFkCAel3a3iuWWR+Vh\/TyUpxQgC2rT\/1hPpvQDEP1LGcvb7dHNfFnl1\/3OANpkmUPCK6jbQDyJNqrGFhyhpx+yNs\/ZcOLFXtnqgxN8tez35pv9f3m7CDobr9WT1spvQIzBYZHx0tyd25m0YSloIOm7IwjkzYdu0mAXHTkNuXcFddaFYcx5BU7uxezbRpP7RaaS2xAPI95eCeMDWbRoaPmZy9eultTW9hYqG3c6phomLOWEEG\/D7tBKBGgpAR0UdYFGPgtxVmA5iCVzQKq7Wxn2athOiZtnf0hSVziI7yGHM7QbS9MsOgve+ti0FtVKrpH1fU4OPEUf5YSgV8a541YV2MlGAKvZhNgJFZX57E8uf7Y+Fyei1+W3sU7tfT45356vj7TXNxG0KPonv6HJcaReBf5t0xbMPZXN4V76g8WrXzlIyWJ2+VzLiZ8acw2KnLtf2L6\/WuLaVjChQqXOlLWieM9BxttU0\/PD5B+ubKdYqo7ounuOrSXO9yrRiKG3+l8DBKqrELp4zOoCMe5b95VMrQ+CCZ9knXZiEBgs7dPnGEovQTZqg7ymVmCw6m8Xj\/f5T+U3E8wk\/9PvK2QndVXPNdM5mO+tum7hcSW4QhS+2wUl5kHfZEXGqlXRMS+uEvlgXTrqLccmWVA5Ydfo7SNhMkTJwu\/E8UBfBKnCGjXHW2ZmGplqICOGQ5klV1JBqzv\/f1YodCtYvadJBN1Eo5FPwEdn2LVEj4XDE5a0FQDtuyldSxBIv3WtGW6b2+UfFPO1s5HQokOE1UDyOEh3RTws4Tv\/x0vyJ3+ep2Hx9KitfhcNXcwlNbiDhS4PLdlPqsraxBWX0FV+DUjiSjyTuf\/ozBdVWL6xTtBgREe7JewVeBxSWEXUuMYxURNKKl9dxg0mqltsOINj0ULU0C7kJTTKAz8Z0P\/xQD2pcUBJoPK8T0eRv2syljGE0QA6Ca3XpOuBohh1sqAbRgUuwtrzX\/kBTg0N96rtp3W3CN97S7wqVVss\/EfaUFuWC00LrQkHYlErES9rpOiWju\/1J2RPPkiJkMrXhk\/8GTvvmdQAe6T\/10H1IJ+tBFSFgsCMCl+Tld1h9T7FxzXBxbSi03YCLKEWCmq8UoKsTlExJqZ+qptiooxt8OjO+q9mFN7XqoavqSDsxtg3kZjdpN\/hElgEhnV2AAEPu\/Ed0jJq7T7LY5gpQ6QVL2tvt1sWBv8WcU1DlZOxHPFmG9ZhYqsnaiAWK80MOi60NAqC0EHdQ0oovslqNf\/MdgbrvQMPF4cq\/fs9gUpb2Z78aOg\/TeziZVjaq\/vTuPgA6DtLpqVKAJTwJ3YxVZ5Rmrc8jcrXP4aeJpCzsF3DFMLiS\/sxDxtqyYObJ21evBuZeYmcVj1dVawm6meZbnd84Lje1lEbJ7eQ6w4FOPAVP+M6tF0VcuAPpXadJ3YtWDoINMK6gyudTUbF4qSc5F1dI5GUAS6peOhDDg05xUpo6No4JOYd59AltKOOYVpsOks8wlJ3ge3CVNF2HGituAQUEtAm0PY0bNggxaqdHr57O5w\/f4hnMGLg2YDxUwgAMsr\/FaJpPCuzxXteKl7dMJQXopJHlQnP4flFtjgwzC6KjEn3PAw0+BfMgTxIuxIcoWZvebuyD41FVk1\/h0jIV0CdqLugreO22gPTUbA6Zdys4Ks9MMz6omxyVrn4NBkqcRApOGnz6ydMeZxMIKeiaUOlOWbdZC7ooqalKIP1oXieF\/PuDpapBSyTzEf3o8nJF9plaCNiTC222tBdhLo4n\/+rIOyzb1dP44JIG3tsTFgM8y5jh3yEyIseOm3xbafrWoRfc00HDc2cv8Xq1UVVQ2C6z80WCRLFx1J\/6z89x3BV\/M4m\/Z36RUN6Z50M309G5QEdzLrPp6XMdYuBasSe4bSjQBhTJBG7kbHmakbzAKVsGn8jou0OKHMSrn0Vao0CxYyv1Hja48CY3pqoe2ndf6KJrt\/U8wBzsHfZAclby7Ap3EaENVOGK7RVLNFmmqv2GN2CRXq6AKDQtmBZcO6+ED25VzuxK\/8n1pw7YneU79GQQ3VHqNC5ApiuE+I3f6zDniqbw0NmC6ArHnZKa2so1ANLRDQjWjZC2tzDEvpdvece4YoJCe6yhBwpjxOOHWThhNJBTtqpYEzDCpfj342kNM1YgNiT9V\/+ZkjMBn0\/hde5ZACW0+3dTG3WM9VT\/9CdSD3kD7htVvE22fDrdYTuqYbugwl7so+sraPwbGELlzB+LPYxiaHyve5DU5uboLClXWfjgoCn9RmK+iCEL3oWg2Ux7j6g6UJj5iQS3IIv3WcoEYxcHybRc+3Q6R0faC0v1NhhTTmKe6WZejF7LqK2ACWwsoljKAv5eH3viHJ7kVVvodmWW+RLF4c8sh+92P+gHHvWt++fM0HTAl7t6y+lgE8Ycup80dSrLzYftIg==:utf-8"},"name":"superuser"}],"package_definition_list":[{"description":"CentOS 8 Cloud Image","action_list":[],"type":"SUBSTRATE_IMAGE","service_local_reference_list":[],"name":"CentOS_8_Cloud","version":"","options":{"type":"","name":"CentOS_8_Cloud","resources":{"image_type":"DISK_IMAGE","checksum":{},"source_uri":"https:\/\/cloud.centos.org\/centos\/8\/x86_64\/images\/CentOS-8-GenericCloud-8.2.2004-20200611.2.x86_64.qcow2","version":{"product_version":"8","type":"","product_name":"CentOS"},"architecture":"X86_64","type":""},"description":""},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"WebServer"}],"name":"WebServer_Package","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"WebServer_Package"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Linux_OS_Update"},{"kind":"app_task","name":"InstallWebServer"},{"kind":"app_task","name":"2Tier_Webapp"}],"name":"2f85c1f1_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Linux_OS_Update"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"InstallWebServer"}},{"from_task_reference":{"kind":"app_task","name":"InstallWebServer"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"2Tier_Webapp"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Linux_OS_Update","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo yum -y update\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"InstallWebServer","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\necho \"__ Install httpd and php...\"\r\nsudo yum install -y httpd\r\nsudo yum install -y php php-gd php-mbstring php-pdo php-mysqlnd\r\n\r\necho \"<IfModule mod_dir.c>\r\n        DirectoryIndex index.php index.html\r\n<\/IfModule>\" | sudo tee \/etc\/httpd\/conf.modules.d\/dir.conf\r\n\r\necho \"<?php\r\nphpinfo();\r\n?>\" | sudo tee \/var\/www\/html\/index.php\r\n\r\nsudo systemctl enable httpd\r\n\r\n# temporarily disable SELinux to prevent httpd to MySQL authentication issues\r\n# this is for testing only and should not be done in production environments\r\necho \"__ Temporarily disable SELinux...\"\r\nsudo setenforce 0\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"2Tier_Webapp","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\nsudo touch \/var\/www\/html\/index.php\r\nsudo chown @@{superuser.username}@@:@@{superuser.username}@@ \/var\/www\/html\/index.php\r\n\r\ncat > \/var\/www\/html\/index.php <<- \"EOF\"\r\n<html>\r\n<head>\r\n  <title>@@{calm_blueprint_name}@@<\/title>\r\n<\/head>\r\n<body>\r\n <h1>Hostname: @@{name}@@ at @@{address}@@, replica: @@{calm_array_index}@@<\/h1>\r\n<?php\r\n\r\ntry {\r\n  echo \"<h3>Web docroot: {$_SERVER[\"DOCUMENT_ROOT\"]}, file: {$_SERVER[\"SCRIPT_NAME\"]}<\/h3>\\n\";\r\n}\r\n\r\ncatch (PDOException $e) {\r\n  print \"Error!: \" . $e->getMessage() . \"<br\/>\";\r\n  print phpinfo();\r\n  die();\r\n}\r\n?><\/body>\r\n<\/html>\r\nEOF\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"73d0e18f_runbook","main_task_local_reference":{"kind":"app_task","name":"2f85c1f1_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"WebServer_Package"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Uninstall_WebServer"}],"name":"dd25fcc7_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Uninstall_WebServer","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\nsudo rm -rf \/var\/www\/html\/* || true\r\nsudo yum erase -y httpd php || true\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"8e7c383f_runbook","main_task_local_reference":{"kind":"app_task","name":"dd25fcc7_dag"},"variable_list":[]}},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"name":"d75c33a3_deployment","min_replicas":"2","default_replicas":"2","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"4","package_local_reference_list":[{"kind":"app_package","name":"WebServer_Package"}],"substrate_local_reference":{"kind":"app_substrate","name":"WebServerAHV"},"variable_list":[],"description":""}],"description":"","action_list":[],"name":"Nutanix","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"USER_INITIALS","value":"amanpreetsingh459","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"superuser"},"type":"USER"},"name":"WebApplication"},"api_version":"3.0","metadata":{"last_update_time":"1608556730316393","kind":"blueprint","spec_version":5,"creation_time":"1608552754433560","name":"WebApplication"}}